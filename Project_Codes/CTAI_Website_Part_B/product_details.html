<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f8f8;
            color: #333;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #ffe5d9;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo img {
            height: 50px;
        }

        .search-box {
            display: flex;
        }

        .search-box input[type="text"] {
            padding: 5px;
            border: none;
            border-radius: 3px 0 0 3px;
            outline: none;
        }

        .search-box button {
            padding: 6px 10px;
            border: none;
            background-color: white;
            color: #007bff;
            cursor: pointer;
            border-radius: 0 3px 3px 0;
            outline: none;
        }

        nav a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
        }

        .product-details-container {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            max-width: 1200px;
            margin: 70px auto 20px; 
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }


        .product-images-container {
            display: flex;
            flex-direction: row; /* Change to horizontal layout */
            align-items: center; /* Center items vertically */
            position: relative; /* Position relative to allow absolute positioning of buttons */
        }

        .slideshow-container {
            flex: 1;
        }

        .slideshow-container img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .navigation-button {
            background-color: #f4ce8d;
            color: white;
            border: none;
            padding: 12px 12px; /* Change padding to make the button square */
            cursor: pointer;
            border-radius: 0; /* Remove border radius to make it square */
            outline: none;
            transition: background-color 0.3s, transform 0.2s;
            font-size: 18px;
        }

        .navigation-button:hover {
            background-color: #0056b3; /* Darker shade on hover */
        }

        .navigation-button:focus {
            outline: 2px solid #0056b3; /* Focus outline */
        }

        .navigation-button:active {
            transform: scale(0.95); /* Slightly shrink on click */
        }

        .product-info {
            flex: 1 1 50%;
            padding: 20px;
        }

        .product-info h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .product-info p {
            margin: 10px 0;
        }

        .color-options {
            display: flex;
            margin: 10px 0;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .color-option.selected {
            border-color: #007bff;
        }

        .add-to-cart-button button {
            background-color: #f4ce8d;
            color: black;
            padding: 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            width: 100%;
            font-size: 16px;
        }

        .button-container {
            margin-top: 20px;
        }

        .button-container input[type="file"] {
            display: none;
        }

        .button-container label {
            background-color: #f4ce8d;
            color: black;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            display: block;
            text-align: center;
        }

        .selected-file-name {
            margin-top: 10px;
            font-size: 16px;
            text-align: center;
        }

        .review-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .reviews-section {
            margin-top: 20px;
        }

        .review {
            display: flex;
            margin-bottom: 20px;
        }

        .profile-icon {
            margin-right: 10px;
        }

        .profile-icon i {
            font-size: 40px;
        }

        .review-content {
            flex: 1;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .review-header .username {
            font-weight: bold;
        }

        .review-text {
            margin-top: 5px;
        }

        .camera-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 1px solid #ccc;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-radius: 10px;
        }

        .camera-container video {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .camera-container button {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        .camera-button {
            display: inline-block;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
        }

        .camera-button i {
            font-size: 24px;
        }

        .countdown {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }

        footer {
            background-color: #ffe5d9;
            color: black;
            text-align: center;
            padding: 10px;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="images/logo.png" alt="E-Commerce Shopping Store" id="logo-img">
        </div>
        <div class="search-box">
            <input type="text" placeholder="Search...">
            <button type="button">Search</button>
        </div>
        <nav>
            <a href="index.html"><i class="fas fa-home"></i></a>
            <a href="shopping_cart.html"><i class="fas fa-shopping-cart"></i></a>
            <a id="profile-icon"><i class="fas fa-user"></i></a>
        </nav>
    </header>

    <div class="product-details-container">
        <!-- Product Images Container -->
        <div class="product-images-container">
            <div class="product-images slideshow-container" id="product-images">
                <!-- Images will be dynamically loaded here -->
            </div>
            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button class="navigation-button prev-button" onclick="changeSlide(-1)">
                    <span>&#10094;</span>
                </button>
                <button class="navigation-button next-button" onclick="changeSlide(1)">
                    <span>&#10095;</span>
                </button>
            </div>
        </div>
        <!-- Product Info Section -->
        <div class="product-info">
            <h1 id="productName"></h1>
            <p id="productPrice"></p>
            <p id="productDescription"></p>
            <div class="color-options" id="color-options">
                <!-- Color options will be dynamically loaded here -->
            </div>
            <div class="add-to-cart-button">
                <button onclick="addToCart()">Add to Cart</button>
            </div>
            <div class="button-container">
                <input type="file" id="fileInput" onchange="uploadImage(event)">
                <label for="fileInput">Virtual Dressing Room - Upload Image</label>
                <div class="selected-file-name" id="selectedFileName"></div>
            </div>
        </div>
    </div>
    <div class="review-container">
        <div class="reviews-section">
            <h2>Customer Reviews</h2>
            <!-- Reviews will be dynamically loaded here -->
        </div>
    </div>

    <!-- Camera Container -->
    <div class="camera-container" id="cameraContainer">
        <video id="camera" autoplay></video>
        <button onclick="takePhoto()">Take Photo</button>
        <div class="countdown" id="countdown"></div>
    </div>

    <button class="camera-button" onclick="openCamera()">
        <i class="fas fa-camera"></i>
    </button>

    <footer>
        <p>&copy; 2024 E-Commerce Shopping Store. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            if (productId) {
                fetchProductDetails(productId);
            }
        });

        let currentSlideIndex = 0;

        async function fetchProductDetails(productId) {
            try {
                const response = await fetch('https://ctai-project-part-2-shubham-kaushik.s3.amazonaws.com/products.json');
                const products = await response.json(); // The JSON is an array of products

                // Use a loop to find the product
                let product;
                for (const p of products) {
                    if (p.id === parseInt(productId)) {
                        product = p;
                        break;
                    }
                }

                if (product) {
                    displayProductDetails(product);
                } else {
                    console.error('Product not found');
                }
            } catch (error) {
                console.error('Error fetching product details:', error);
            }
        }



        function displayProductDetails(product) {
            document.getElementById('productName').textContent = product.name;

            // Convert price to number, then format it with .toFixed(2)
            const priceNumber = parseFloat(product.price.replace('$', ''));
            document.getElementById('productPrice').textContent = `$${priceNumber.toFixed(2)}`;

            document.getElementById('productDescription').textContent = product.description;

            const productImagesContainer = document.getElementById('product-images');
            productImagesContainer.innerHTML = '';

            // Assuming you want to display one image for a specific color, e.g., "red"
            const color = 'red'; // This might be dynamic based on user selection
            const images = product.images[color];

            if (images && Array.isArray(images) && images.length > 0) {
                // Display only the first image
                const img = document.createElement('img');
                img.src = images[0]; // Select the first image
                productImagesContainer.appendChild(img);
            } else {
                console.error('No images found for the selected color.');
            }

            const colorOptionsContainer = document.getElementById('color-options');
            colorOptionsContainer.innerHTML = '';
            // Add color options based on your product data (assuming you need color options)
            for (const color in product.images) {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color; // Adjust based on how you want to represent colors
                colorOption.addEventListener('click', () => selectColor(colorOption));
                colorOptionsContainer.appendChild(colorOption);
            }

            showSlides(currentSlideIndex);
        }




        function changeSlide(n) {
            showSlides(currentSlideIndex += n);
        }

        function showSlides(n) {
            const slides = document.querySelectorAll('.slideshow-container img');
            if (n >= slides.length) currentSlideIndex = 0;
            if (n < 0) currentSlideIndex = slides.length - 1;
            slides.forEach((slide, index) => {
                slide.style.display = index === currentSlideIndex ? 'block' : 'none';
            });
        }

        function selectColor(colorOption) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            colorOption.classList.add('selected');
        }

        async function addToCart() {
            const productId = new URLSearchParams(window.location.search).get('id');
            if (!productId) {
                alert('Product ID not found');
                return;
            }

            const productName = document.getElementById('productName').textContent;
            const productPrice = document.getElementById('productPrice').textContent.replace('$', '');
            const productDescription = document.getElementById('productDescription').textContent;
            const selectedColorElement = document.querySelector('.color-option.selected');
            const productColor = selectedColorElement ? selectedColorElement.style.backgroundColor : null;
            const productImages = Array.from(document.querySelectorAll('.slideshow-container img')).map(img => img.src);

            const productDetails = {
                id: productId,
                name: productName,
                price: parseFloat(productPrice),
                description: productDescription,
                color: productColor,
                images: productImages
            };

            try {
                const response = await fetch('https://m4zif24gd0.execute-api.us-east-1.amazonaws.com/final-prod/post-product', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productDetails) // Use productDetails instead of product
                });

                if (response.ok) {
                    // Successfully added product
                    alert('Product added to cart!');
                } else {
                    // Check for specific status codes and display appropriate messages
                    if (response.status === 409) {
                        alert('Product already exists in the cart.');
                    } else {
                        // For other error statuses
                        const errorData = await response.json();
                        alert(`Error adding item to cart: ${errorData.message}`);
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An unexpected error occurred while adding the product to the cart.');
            }
        }


        function uploadImage(event) {
            const file = event.target.files[0];
            document.getElementById('selectedFileName').textContent = file ? file.name : '';
            console.log("Selected file:", file); // Log file info

            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const base64EncodedImage = event.target.result.split(',')[1];
                    console.log("Base64 Image Data:", base64EncodedImage); // Log base64 data

                    fetch('https://xipl1mh9a4.execute-api.us-east-1.amazonaws.com/prod/upload-pic', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            image: base64EncodedImage
                        }),
                    })
                    .then(response => {
                        console.log("Response Status:", response.status); // Log response status
                        return response.json();
                    })
                    .then(data => {
                        console.log('Lambda Response:', data);
                        alert('Image uploaded successfully!');
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Error uploading image.');
                    });
                };

                reader.readAsDataURL(file);
            }
        }
        let videoStream;
        function openCamera() {
            const cameraContainer = document.getElementById('cameraContainer');
            cameraContainer.style.display = 'block';
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    videoStream = stream;
                    const video = document.getElementById('camera');
                    video.srcObject = stream;
                })
                .catch(error => console.error('Error accessing camera:', error));
        }

        function takePhoto() {
            const cameraContainer = document.getElementById('cameraContainer');
            const video = document.getElementById('camera');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageData = canvas.toDataURL('image/png');
            document.getElementById('selectedFileName').textContent = 'Captured Image';
            closeCamera();

            alert('Photo taken!');
        }

        function closeCamera() {
            const cameraContainer = document.getElementById('cameraContainer');
            cameraContainer.style.display = 'none';
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
            }
        }
    </script>
</body>
</html>












